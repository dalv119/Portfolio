# Cозданиt хранилища DWH (SCD2) с ветриной данных по мошенническим операциям

## Описание проекта
Разработать ETL процесс, получающий ежедневную выгрузку данных
(предоставляется за 3 дня), загружающий ее в хранилище данных и ежедневно
строящий отчет.

## Задачи проекта
Выявить признаки мошеннических операций:
1. Совершение операции при просроченном или заблокированном паспорте.
2. Совершение операции при недействующем договоре.
3. Совершение операций в разных городах в течение одного часа.
4. Попытка подбора суммы. В течение 20 минут проходит более 3х
операций со следующим шаблоном – каждая последующая меньше предыдущей,
при этом отклонены все кроме последней. Последняя операция (успешная) в
такой цепочке считается мошеннической.
   
## Инструменты
> Python, PostgreSQL, pandas, psycopg2, shutil, os
### Навыки
- построение DWH; 
- написание ETL-пайплайна.




### Выгрузка данных.
Ежедневно некие информационные системы выгружают три следующих
файла:
1. Список транзакций за текущий день. Формат – CSV.
2. Список терминалов полным срезом. Формат – XLSX.
3. Список паспортов, включенных в «черный список» - с накоплением с
начала месяца. Формат – XLSX.

Сведения о картах, счетах и клиентах хранятся в СУБД PostgreSQL.

### Структура хранилища.

[![ER-диаграмма](https://readme-typing-svg.herokuapp.com?color=%2336BCF7&lines=ER-диаграмма)](https://git.io/typing-svg)
![ER-диаграмма](https://github.com/dalv119/Data_Engineer/blob/main/Projects/DWH-Bank/ER_диаграмма.png)

Ко всем таблицам SCD2
должны быть добавлены технические поля effective_from, effective_to, deleted_flg.

### Построение отчета.
По результатам загрузки ежедневно необходимо строить витрину
отчетности по мошенническим операциям. Витрина строится накоплением,
каждый новый отчет укладывается в эту же таблицу с новым report_dt.
В витрине должны содержаться следующие поля:
Поле     | Описание
:--------|:--------------------------------------------------------------
event_dt | Время наступления события. Если событие наступило по результату нескольких действий – указывается время действия, по которому установлен факт мошенничества.
passport | Номер паспорта клиента, совершившего мошенническую операцию.
fio      | ФИО клиента, совершившего мошенническую операцию. 
phone    | Номер телефона клиента, совершившего мошенническую операцию.
event_type | Описание типа мошенничества (номер).
report_dt | Дата, на которую построен отчет.

### Обработка файлов
Выгружаемые файлы именуются согласно следующему шаблону:
transactions_DDMMYYYY.txt
passport_blacklist_DDMMYYYY.xlsx
terminals_DDMMYYYY.xlsx
Предполагается что в один день приходит по одному такому файлу. После
загрузки соответствующего файла он должен быть переименован в файл с
расширением .backup чтобы при следующем запуске файл не искался и перемещен в каталог archive:
transactions_DDMMYYYY.txt.backup
passport_blacklist_DDMMYYYY.xlsx.backup
terminals_DDMMYYYY.xlsx.backup

### Проверка результата

Наименование файла     | Статус               | Описание
:----------------------|:---------------------|:---------------------------
[main.py](https://github.com/dalv119/Data_Engineer/blob/main/Projects/DWH-Bank/main.py) | Файл, обязательный  | Основной процесс обработки.
файлы с данными | Файл, обязательный | Те файлы, которые вы обязательный получили в качестве задания. Просто скопируйте все 9 файлов.
[main.ddl](https://github.com/dalv119/Data_Engineer/blob/main/Projects/DWH-Bank/main.ddl) | Файл, обязательный | Файл с SQL кодом для обязательный создания всех необходимых объектов в базе.
[main.cron]() | Файл, обязательный | Файл для постановки обязательный вашего процесса на расписание, в формате crontab
archive | Каталог, обязательный | Пустой, сюда должны обязательный перемещаться отработанные файлы
sql_scripts | Каталог, необязательный | Если вы включаете в необязательный main.py какие-то SQL скрипты, вынесенные в отдельные файлы – помещайте их сюда.
py_scripts | Каталог, необязательный | Если вы включаете в необязательный main.py какие-то python скрипты, вынесенные в отдельные файлы – помещайте их сюда.








